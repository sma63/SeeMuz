using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
//using System.Numerics;

namespace audio_sma
{
	class Fir
	{
		int n, idata;
		double [] coef;
		double [] data;

		public Fir (int n_, double [] coef_)
		{
			n = n_;
			idata = 0;
			coef = coef_;
			data = new double [n];
			for (int i = 0; i < n; i++)
			{
				data [i] = 0.0;
			}
		}

		public double Go (double v)
		{
			data [idata] = v;
			idata = (idata + 1) % n;
			v = 0.0;
			for (int i = 0, j = idata; i < n; i++, j = (j + 1) % n)
			{
				v += coef [i] * data [j];
			}
			return v;
		}

		// halfband
		public double Half (double x)
		{
			for (int i = 0, j = 1; j < n; i++, j++)
			{
				data [i] = data [j];
			}
			data [n - 1] = x;
			{
				int i = n / 2; //31 / 2 = 15;
				int j = i;
				x = data [i--] * coef [j++]; //i=14,j=16
				for (; 0 <= i; i -= 2, j += 2)
				{
					x += (data [j] + data [i]) * coef [i];
				}
			}
			return x;
		}

		// симметрия коэфициентов
		public double Sim (double x)
		{
			if (n <= 1) return x;

			for (int i = 0, j = 1; j < n; i++, j++)
			{
				data [i] = data [j];
			}
			data [n - 1] = x;
			{
				int i = n / 2; //33 / 2 = 16;
				int j = i;
				x = data [i--] * coef [j++];
				for (; 0 <= i; i--, j++)
				{
					x += (data [i] + data [j]) * coef [j];
				}
			}
			return x;
		}

		public void Load (double v)
		{
			data [idata] = v;
			idata = (idata + 1) % n;
		}

		public double Go ()
		{
			double v = 0.0;
			for (int i = 0, j = idata; i < n; i++, j = (j + 1) % n)
			{
				v += coef [i] * data [j];
			}
			return v;
		}

		public static double [] coef2 = new double [] //33
		{
			 0,
			-0.0018852172726891872,
			 0,
			 0.0038570338166836345,
			 0,
			-0.0082308481477312741,
			 0,
			 0.015924635174316786,
			 0,
			-0.028636137215663268,
			 0,
			 0.050647069490689985,
			 0,
			-0.097877745820535586,
			 0,
			 0.3154964179881562,
			 0.5,
			 0.3154964179881562,
			 0,
			-0.097877745820535586,
			 0,
			 0.050647069490689985,
			 0,
			-0.028636137215663268,
			 0,
			 0.015924635174316786,
			 0,
			-0.0082308481477312741,
			 0,
			 0.0038570338166836345,
			 0,
			-0.0018852172726891872,
			 0
		};

		public static double [] coef3 = new double [] //33
		{
			-0.0013786526014400433,
			 0.0000000000000000011546393325250097,
			 0.0022652328736747353,
			 0.0033410898850579889,
			-0.0000000000000000027908616686126,
			-0.0071298320934812028,
			-0.010035643007617619,
			 0.0000000000000000058520183518631143,
			 0.018611810119440617,
			 0.024805566387449907,
			-0.0000000000000000093063135370148265,
			-0.043872161776551309,
			-0.05964527611659199,
			 0.000000000000000011989439810517597,
			 0.13303785083980171,
			 0.27329340135747043,
			 0.33341322826557379,
			 0.27329340135747043,
			 0.13303785083980171,
			 0.000000000000000011989439810517597,
			-0.05964527611659199,
			-0.043872161776551309,
			-0.0000000000000000093063135370148265,
			 0.024805566387449907,
			 0.018611810119440617,
			 0.0000000000000000058520183518631143,
			-0.010035643007617619,
			-0.0071298320934812028,
			-0.0000000000000000027908616686126,
			 0.0033410898850579889,
			 0.0022652328736747353,
			 0.0000000000000000011546393325250097,
			-0.0013786526014400433
		};

		public static double [] coef4 = new double [] //33
		{
			-0.00000000000000000078147284000169877,
			-0.0013361934128000967,
			-0.0026212054161720995,
			-0.0027337661570691397,
			 0.0000000000000000020975793892611778,
			 0.0058338130230836411,
			 0.011612705303743637,
			 0.01128697096585265,
			-0.0000000000000000052749416700114659,
			-0.020296555983187914,
			-0.038076381151828174,
			-0.035897337464213849,
			 0.0000000000000000084523039507617541,
			 0.06937322351103016,
			 0.15394423206099803,
			 0.22361572938298782,
			 0.25058953067515094,
			 0.22361572938298782,
			 0.15394423206099803,
			 0.06937322351103016,
			 0.0000000000000000084523039507617541,
			-0.035897337464213849,
			-0.038076381151828174,
			-0.020296555983187914,
			-0.0000000000000000052749416700114659,
			 0.01128697096585265,
			 0.011612705303743637,
			 0.0058338130230836411,
			 0.0000000000000000020975793892611778,
			-0.0027337661570691397,
			-0.0026212054161720995,
			-0.0013361934128000967,
			-0.00000000000000000078147284000169877,
		};

		public static double [] coef5 = new double [] //33
		{
			-0.00093504638020070092,
			0.0000000000000000006922896726344529,
			0.0015363535357847018,
			0.003666520423535925,
			0.005414570943990055,
			0.0048356806373736141,
			-0.0000000000000000028362576137922585,
			-0.0093558341239606373,
			-0.020424647127000938,
			-0.0272216907972779,
			-0.022317511802614234,
			0.0000000000000000061995406162723061,
			0.040453337897187497,
			0.093043196175349285,
			0.14599607133855741,
			0.18535634387163141,
			0.19990531081528926,
			0.18535634387163141,
			0.14599607133855741,
			0.093043196175349285,
			0.040453337897187497,
			0.0000000000000000061995406162723061,
			-0.022317511802614234,
			-0.0272216907972779,
			-0.020424647127000938,
			-0.0093558341239606373,
			-0.0000000000000000028362576137922585,
			0.0048356806373736141,
			0.005414570943990055,
			0.003666520423535925,
			0.0015363535357847018,
			0.0000000000000000006922896726344529,
			-0.00093504638020070092,
		};

		public static double [] coef6 = new double [] //33
		{
			0.0013610593157720543,
			0.0018798237007866582,
			0.0022773628028421454,
			0.0019684058600114283,
			0.000071379107290583653,
			-0.0040220004860546683,
			-0.0099447253029136332,
			-0.015880328967464701,
			-0.018645505549971478,
			-0.014459774161568515,
			-0.00023802307094422949,
			0.025024824734246897,
			0.059323378751843334,
			0.097609279581621092,
			0.13280190677050147,
			0.15760155589279637,
			0.16654276204241017,
			0.15760155589279637,
			0.13280190677050147,
			0.097609279581621092,
			0.059323378751843334,
			0.025024824734246897,
			-0.00023802307094422949,
			-0.014459774161568515,
			-0.018645505549971478,
			-0.015880328967464701,
			-0.0099447253029136332,
			-0.0040220004860546683,
			0.000071379107290583653,
			0.0019684058600114283,
			0.0022773628028421454,
			0.0018798237007866582,
			0.0013610593157720543,
		};

		public static double [] coef7 = new double [] //33
		{
			0.0012467672494068005,
			0.00082629934534465713,
			0.000016369617096873501,
			-0.001647058508712344,
			-0.0044175791540554113,
			-0.0079855628210180746,
			-0.011264362959418036,
			-0.012443975761307093,
			-0.0093569377306163878,
			-0.000089628671774748597,
			0.016328740147020588,
			0.03937965175215194,
			0.066852634633103716,
			0.0950983272805761,
			0.11971473702058369,
			0.13650723782756929,
			0.14246868146809644,
			0.13650723782756929,
			0.11971473702058369,
			0.0950983272805761,
			0.066852634633103716,
			0.03937965175215194,
			0.016328740147020588,
			-0.000089628671774748597,
			-0.0093569377306163878,
			-0.012443975761307093,
			-0.011264362959418036,
			-0.0079855628210180746,
			-0.0044175791540554113,
			-0.001647058508712344,
			0.000016369617096873501,
			0.00082629934534465713,
			0.0012467672494068005,
		};

	}
}
