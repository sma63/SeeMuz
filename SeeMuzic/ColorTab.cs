using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.IO;
using System.Xml;
using System.Xml.Linq;
using System.Threading;

namespace SeeMuzic
{
	public partial class Form1 : Form
	{
		public static Color H2Color (double h, double v) //цвет, яркость
		{
			//if (1.0 <= v) return Color.FromArgb (255, 255, 255); //

			int z = 0;
			if (v < 0.0) v = 0.0; else if (v < 1.0) v *= 255.0; else { v = 255.0; z = (int)((v - 1.0) * 64.0); if (255 < z) z = 255; }
			double h6 = (h - Math.Floor (h)) * 6.0;
			int a = (int)((h6 - Math.Floor (h6)) * v);
			int b = (int)v;
			int c = b - a;
			switch ((int)h6)
			{
				case 0: return Color.FromArgb (b, a, z);
				case 1: return Color.FromArgb (c, b, z);
				case 2: return Color.FromArgb (z, b, a);
				case 3: return Color.FromArgb (z, c, b);
				case 4: return Color.FromArgb (a, z, b);
				default: return Color.FromArgb (b, z, c);
			}
		}
		// H2Color

		Color TriColor (double a, double b)
		{
			int i = (int)(a * 768.0) % 768;
			if (i < 0) i += 768;
			if (b < 0.0f) b += 1.0; //получение негатива
			if (b < 0.0) b = 0.0; else if (1.0 < b) b = 1.0;
			return Color.FromArgb ((int)(Tab [i, 0] * b), (int)(Tab [i, 1] * b), (int)(Tab [i, 2] * b));
		}
		// TriColor

		/*
		double step = Math.PI * 2.0 / 3.0;
		for (double i = 0.0; i < 768.0; i += 1.0)
		{
			double a = (i / 768.0) * Math.PI * 2.0;
			double r = 0.5 * (1.0 + Math.Cos (a)); r = (r * 255.0) + 0.5; a += step;
			double g = 0.5 * (1.0 + Math.Cos (a)); g = (g * 255.0) + 0.5; a += step;
			double b = 0.5 * (1.0 + Math.Cos (a)); b = (b * 255.0) + 0.5;
		}
		*/

		double [,] Tab = new double [768, 3] // 256 * 3 = 768
		{
			{255,   64,     64},	{255,   65,     63},	{255,   66,     62},	{255,   66,     61},	{255,   67,     60},	{255,   68,     59},	{255,   69,     58},	{255,   70,     58},
			{255,   71,     57},	{255,   72,     56},	{255,   73,     55},	{254,   74,     54},	{254,   75,     53},	{254,   76,     52},	{254,   77,     52},	{254,   78,     51},
			{254,   79,     50},	{254,   80,     49},	{254,   81,     48},	{253,   82,     47},	{253,   83,     47},	{253,   84,     46},	{253,   85,     45},	{253,   86,     44},
			{253,   87,     43},	{252,   88,     43},	{252,   88,     42},	{252,   89,     41},	{252,   90,     40},	{251,   91,     40},	{251,   92,     39},	{251,   93,     38},
			{251,   95,     37},	{250,   96,     37},	{250,   97,     36},	{250,   98,     35},	{250,   99,     34},	{249,   100,    34},	{249,   101,    33},	{249,   102,    32},
			{248,   103,    32},	{248,   104,    31},	{248,   105,    30},	{247,   106,    30},	{247,   107,    29},	{246,   108,    28},	{246,   109,    28},	{246,   110,    27},
			{245,   111,    26},	{245,   112,    26},	{244,   113,    25},	{244,   114,    24},	{244,   115,    24},	{243,   116,    23},	{243,   117,    23},	{242,   118,    22},
			{242,   119,    21},	{241,   120,    21},	{241,   121,    20},	{240,   122,    20},	{240,   123,    19},	{239,   124,    19},	{239,   125,    18},	{238,   126,    18},
			{238,   128,    17},	{237,   129,    17},	{237,   130,    16},	{236,   131,    16},	{236,   132,    15},	{235,   133,    15},	{235,   134,    14},	{234,   135,    14},
			{234,   136,    13},	{233,   137,    13},	{232,   138,    12},	{232,   139,    12},	{231,   140,    11},	{231,   141,    11},	{230,   142,    11},	{229,   143,    10},
			{229,   144,    10},	{228,   145,    9},	{227,   146,    9},	{227,   147,    9},	{226,   148,    8},	{225,   149,    8},	{225,   150,    7},	{224,   151,    7},
			{223,   152,    7},	{223,   153,    6},	{222,   154,    6},	{221,   155,    6},	{221,   156,    5},	{220,   157,    5},	{219,   158,    5},	{218,   159,    5},
			{218,   160,    4},	{217,   162,    4},	{216,   163,    4},	{215,   164,    4},	{215,   165,    3},	{214,   166,    3},	{213,   167,    3},	{212,   167,    3},
			{212,   168,    2},	{211,   169,    2},	{210,   170,    2},	{209,   171,    2},	{208,   172,    2},	{208,   173,    2},	{207,   174,    1},	{206,   175,    1},
			{205,   176,    1},	{204,   177,    1},	{203,   178,    1},	{203,   179,    1},	{202,   180,    1},	{201,   181,    1},	{200,   182,    0},	{199,   183,    0},
			{198,   184,    0},	{197,   185,    0},	{197,   186,    0},	{196,   187,    0},	{195,   188,    0},	{194,   189,    0},	{193,   189,    0},	{192,   190,    0},
			{191,   191,    0},	{190,   192,    0},	{189,   193,    0},	{189,   194,    0},	{188,   195,    0},	{187,   196,    0},	{186,   197,    0},	{185,   197,    0},
			{184,   198,    0},	{183,   199,    0},	{182,   200,    0},	{181,   201,    1},	{180,   202,    1},	{179,   203,    1},	{178,   203,    1},	{177,   204,    1},
			{176,   205,    1},	{175,   206,    1},	{174,   207,    1},	{173,   208,    2},	{172,   208,    2},	{171,   209,    2},	{170,   210,    2},	{169,   211,    2},
			{168,   212,    2},	{167,   212,    3},	{167,   213,    3},	{166,   214,    3},	{165,   215,    3},	{164,   215,    4},	{163,   216,    4},	{162,   217,    4},
			{160,   218,    4},	{159,   218,    5},	{158,   219,    5},	{157,   220,    5},	{156,   221,    5},	{155,   221,    6},	{154,   222,    6},	{153,   223,    6},
			{152,   223,    7},	{151,   224,    7},	{150,   225,    7},	{149,   225,    8},	{148,   226,    8},	{147,   227,    9},	{146,   227,    9},	{145,   228,    9},
			{144,   229,    10},	{143,   229,    10},	{142,   230,    11},	{141,   231,    11},	{140,   231,    11},	{139,   232,    12},	{138,   232,    12},	{137,   233,    13},
			{136,   234,    13},	{135,   234,    14},	{134,   235,    14},	{133,   235,    15},	{132,   236,    15},	{131,   236,    16},	{130,   237,    16},	{129,   237,    17},
			{128,   238,    17},	{126,   238,    18},	{125,   239,    18},	{124,   239,    19},	{123,   240,    19},	{122,   240,    20},	{121,   241,    20},	{120,   241,    21},
			{119,   242,    21},	{118,   242,    22},	{117,   243,    23},	{116,   243,    23},	{115,   244,    24},	{114,   244,    24},	{113,   244,    25},	{112,   245,    26},
			{111,   245,    26},	{110,   246,    27},	{109,   246,    28},	{108,   246,    28},	{107,   247,    29},	{106,   247,    30},	{105,   248,    30},	{104,   248,    31},
			{103,   248,    32},	{102,   249,    32},	{101,   249,    33},	{100,   249,    34},	{99,    250,    34},	{98,    250,    35},	{97,    250,    36},	{96,    250,    37},
			{95,    251,    37},	{93,    251,    38},	{92,    251,    39},	{91,    251,    40},	{90,    252,    40},	{89,    252,    41},	{88,    252,    42},	{88,    252,    43},
			{87,    253,    43},	{86,    253,    44},	{85,    253,    45},	{84,    253,    46},	{83,    253,    47},	{82,    253,    47},	{81,    254,    48},	{80,    254,    49},
			{79,    254,    50},	{78,    254,    51},	{77,    254,    52},	{76,    254,    52},	{75,    254,    53},	{74,    254,    54},	{73,    255,    55},	{72,    255,    56},
			{71,    255,    57},	{70,    255,    58},	{69,    255,    58},	{68,    255,    59},	{67,    255,    60},	{66,    255,    61},	{66,    255,    62},	{65,    255,    63},
			{64,    255,    64},	{63,    255,    65},	{62,    255,    66},	{61,    255,    66},	{60,    255,    67},	{59,    255,    68},	{58,    255,    69},	{58,    255,    70},
			{57,    255,    71},	{56,    255,    72},	{55,    255,    73},	{54,    254,    74},	{53,    254,    75},	{52,    254,    76},	{52,    254,    77},	{51,    254,    78},
			{50,    254,    79},	{49,    254,    80},	{48,    254,    81},	{47,    253,    82},	{47,    253,    83},	{46,    253,    84},	{45,    253,    85},	{44,    253,    86},
			{43,    253,    87},	{43,    252,    88},	{42,    252,    88},	{41,    252,    89},	{40,    252,    90},	{40,    251,    91},	{39,    251,    92},	{38,    251,    93},
			{37,    251,    95},	{37,    250,    96},	{36,    250,    97},	{35,    250,    98},	{34,    250,    99},	{34,    249,    100},	{33,    249,    101},	{32,    249,    102},
			{32,    248,    103},	{31,    248,    104},	{30,    248,    105},	{30,    247,    106},	{29,    247,    107},	{28,    246,    108},	{28,    246,    109},	{27,    246,    110},
			{26,    245,    111},	{26,    245,    112},	{25,    244,    113},	{24,    244,    114},	{24,    244,    115},	{23,    243,    116},	{23,    243,    117},	{22,    242,    118},
			{21,    242,    119},	{21,    241,    120},	{20,    241,    121},	{20,    240,    122},	{19,    240,    123},	{19,    239,    124},	{18,    239,    125},	{18,    238,    126},
			{17,    238,    128},	{17,    237,    129},	{16,    237,    130},	{16,    236,    131},	{15,    236,    132},	{15,    235,    133},	{14,    235,    134},	{14,    234,    135},
			{13,    234,    136},	{13,    233,    137},	{12,    232,    138},	{12,    232,    139},	{11,    231,    140},	{11,    231,    141},	{11,    230,    142},	{10,    229,    143},
			{10,    229,    144},	{9,     228,    145},	{9,     227,    146},	{9,     227,    147},	{8,     226,    148},	{8,     225,    149},	{7,     225,    150},	{7,     224,    151},
			{7,     223,    152},	{6,     223,    153},	{6,     222,    154},	{6,     221,    155},	{5,     221,    156},	{5,     220,    157},	{5,     219,    158},	{5,     218,    159},
			{4,     218,    160},	{4,     217,    162},	{4,     216,    163},	{4,     215,    164},	{3,     215,    165},	{3,     214,    166},	{3,     213,    167},	{3,     212,    167},
			{2,     212,    168},	{2,     211,    169},	{2,     210,    170},	{2,     209,    171},	{2,     208,    172},	{2,     208,    173},	{1,     207,    174},	{1,     206,    175},
			{1,     205,    176},	{1,     204,    177},	{1,     203,    178},	{1,     203,    179},	{1,     202,    180},	{1,     201,    181},	{0,     200,    182},	{0,     199,    183},
			{0,     198,    184},	{0,     197,    185},	{0,     197,    186},	{0,     196,    187},	{0,     195,    188},	{0,     194,    189},	{0,     193,    189},	{0,     192,    190},
			{0,     191,    191},	{0,     190,    192},	{0,     189,    193},	{0,     189,    194},	{0,     188,    195},	{0,     187,    196},	{0,     186,    197},	{0,     185,    197},
			{0,     184,    198},	{0,     183,    199},	{0,     182,    200},	{1,     181,    201},	{1,     180,    202},	{1,     179,    203},	{1,     178,    203},	{1,     177,    204},
			{1,     176,    205},	{1,     175,    206},	{1,     174,    207},	{2,     173,    208},	{2,     172,    208},	{2,     171,    209},	{2,     170,    210},	{2,     169,    211},
			{2,     168,    212},	{3,     167,    212},	{3,     167,    213},	{3,     166,    214},	{3,     165,    215},	{4,     164,    215},	{4,     163,    216},	{4,     162,    217},
			{4,     160,    218},	{5,     159,    218},	{5,     158,    219},	{5,     157,    220},	{5,     156,    221},	{6,     155,    221},	{6,     154,    222},	{6,     153,    223},
			{7,     152,    223},	{7,     151,    224},	{7,     150,    225},	{8,     149,    225},	{8,     148,    226},	{9,     147,    227},	{9,     146,    227},	{9,     145,    228},
			{10,    144,    229},	{10,    143,    229},	{11,    142,    230},	{11,    141,    231},	{11,    140,    231},	{12,    139,    232},	{12,    138,    232},	{13,    137,    233},
			{13,    136,    234},	{14,    135,    234},	{14,    134,    235},	{15,    133,    235},	{15,    132,    236},	{16,    131,    236},	{16,    130,    237},	{17,    129,    237},
			{17,    127,    238},	{18,    126,    238},	{18,    125,    239},	{19,    124,    239},	{19,    123,    240},	{20,    122,    240},	{20,    121,    241},	{21,    120,    241},
			{21,    119,    242},	{22,    118,    242},	{23,    117,    243},	{23,    116,    243},	{24,    115,    244},	{24,    114,    244},	{25,    113,    244},	{26,    112,    245},
			{26,    111,    245},	{27,    110,    246},	{28,    109,    246},	{28,    108,    246},	{29,    107,    247},	{30,    106,    247},	{30,    105,    248},	{31,    104,    248},
			{32,    103,    248},	{32,    102,    249},	{33,    101,    249},	{34,    100,    249},	{34,    99,     250},	{35,    98,     250},	{36,    97,     250},	{37,    96,     250},
			{37,    95,     251},	{38,    93,     251},	{39,    92,     251},	{40,    91,     251},	{40,    90,     252},	{41,    89,     252},	{42,    88,     252},	{43,    88,     252},
			{43,    87,     253},	{44,    86,     253},	{45,    85,     253},	{46,    84,     253},	{47,    83,     253},	{47,    82,     253},	{48,    81,     254},	{49,    80,     254},
			{50,    79,     254},	{51,    78,     254},	{52,    77,     254},	{52,    76,     254},	{53,    75,     254},	{54,    74,     254},	{55,    73,     255},	{56,    72,     255},
			{57,    71,     255},	{58,    70,     255},	{58,    69,     255},	{59,    68,     255},	{60,    67,     255},	{61,    66,     255},	{62,    66,     255},	{63,    65,     255},
			{64,    64,     255},	{65,    63,     255},	{66,    62,     255},	{66,    61,     255},	{67,    60,     255},	{68,    59,     255},	{69,    58,     255},	{70,    58,     255},
			{71,    57,     255},	{72,    56,     255},	{73,    55,     255},	{74,    54,     254},	{75,    53,     254},	{76,    52,     254},	{77,    52,     254},	{78,    51,     254},
			{79,    50,     254},	{80,    49,     254},	{81,    48,     254},	{82,    47,     253},	{83,    47,     253},	{84,    46,     253},	{85,    45,     253},	{86,    44,     253},
			{87,    43,     253},	{88,    43,     252},	{88,    42,     252},	{89,    41,     252},	{90,    40,     252},	{91,    40,     251},	{92,    39,     251},	{93,    38,     251},
			{95,    37,     251},	{96,    37,     250},	{97,    36,     250},	{98,    35,     250},	{99,    34,     250},	{100,   34,     249},	{101,   33,     249},	{102,   32,     249},
			{103,   32,     248},	{104,   31,     248},	{105,   30,     248},	{106,   30,     247},	{107,   29,     247},	{108,   28,     246},	{109,   28,     246},	{110,   27,     246},
			{111,   26,     245},	{112,   26,     245},	{113,   25,     244},	{114,   24,     244},	{115,   24,     244},	{116,   23,     243},	{117,   23,     243},	{118,   22,     242},
			{119,   21,     242},	{120,   21,     241},	{121,   20,     241},	{122,   20,     240},	{123,   19,     240},	{124,   19,     239},	{125,   18,     239},	{126,   18,     238},
			{127,   17,     238},	{129,   17,     237},	{130,   16,     237},	{131,   16,     236},	{132,   15,     236},	{133,   15,     235},	{134,   14,     235},	{135,   14,     234},
			{136,   13,     234},	{137,   13,     233},	{138,   12,     232},	{139,   12,     232},	{140,   11,     231},	{141,   11,     231},	{142,   11,     230},	{143,   10,     229},
			{144,   10,     229},	{145,   9,      228},	{146,   9,      227},	{147,   9,      227},	{148,   8,      226},	{149,   8,      225},	{150,   7,      225},	{151,   7,      224},
			{152,   7,      223},	{153,   6,      223},	{154,   6,      222},	{155,   6,      221},	{156,   5,      221},	{157,   5,      220},	{158,   5,      219},	{159,   5,      218},
			{160,   4,      218},	{162,   4,      217},	{163,   4,      216},	{164,   4,      215},	{165,   3,      215},	{166,   3,      214},	{167,   3,      213},	{167,   3,      212},
			{168,   2,      212},	{169,   2,      211},	{170,   2,      210},	{171,   2,      209},	{172,   2,      208},	{173,   2,      208},	{174,   1,      207},	{175,   1,      206},
			{176,   1,      205},	{177,   1,      204},	{178,   1,      203},	{179,   1,      203},	{180,   1,      202},	{181,   1,      201},	{182,   0,      200},	{183,   0,      199},
			{184,   0,      198},	{185,   0,      197},	{186,   0,      197},	{187,   0,      196},	{188,   0,      195},	{189,   0,      194},	{189,   0,      193},	{190,   0,      192},
			{191,   0,      191},	{192,   0,      190},	{193,   0,      189},	{194,   0,      189},	{195,   0,      188},	{196,   0,      187},	{197,   0,      186},	{197,   0,      185},
			{198,   0,      184},	{199,   0,      183},	{200,   0,      182},	{201,   1,      181},	{202,   1,      180},	{203,   1,      179},	{203,   1,      178},	{204,   1,      177},
			{205,   1,      176},	{206,   1,      175},	{207,   1,      174},	{208,   2,      173},	{208,   2,      172},	{209,   2,      171},	{210,   2,      170},	{211,   2,      169},
			{212,   2,      168},	{212,   3,      167},	{213,   3,      167},	{214,   3,      166},	{215,   3,      165},	{215,   4,      164},	{216,   4,      163},	{217,   4,      162},
			{218,   4,      160},	{218,   5,      159},	{219,   5,      158},	{220,   5,      157},	{221,   5,      156},	{221,   6,      155},	{222,   6,      154},	{223,   6,      153},
			{223,   7,      152},	{224,   7,      151},	{225,   7,      150},	{225,   8,      149},	{226,   8,      148},	{227,   9,      147},	{227,   9,      146},	{228,   9,      145},
			{229,   10,     144},	{229,   10,     143},	{230,   11,     142},	{231,   11,     141},	{231,   11,     140},	{232,   12,     139},	{232,   12,     138},	{233,   13,     137},
			{234,   13,     136},	{234,   14,     135},	{235,   14,     134},	{235,   15,     133},	{236,   15,     132},	{236,   16,     131},	{237,   16,     130},	{237,   17,     129},
			{238,   17,     128},	{238,   18,     126},	{239,   18,     125},	{239,   19,     124},	{240,   19,     123},	{240,   20,     122},	{241,   20,     121},	{241,   21,     120},
			{242,   21,     119},	{242,   22,     118},	{243,   23,     117},	{243,   23,     116},	{244,   24,     115},	{244,   24,     114},	{244,   25,     113},	{245,   26,     112},
			{245,   26,     111},	{246,   27,     110},	{246,   28,     109},	{246,   28,     108},	{247,   29,     107},	{247,   30,     106},	{248,   30,     105},	{248,   31,     104},
			{248,   32,     103},	{249,   32,     102},	{249,   33,     101},	{249,   34,     100},	{250,   34,     99},	{250,   35,     98},	{250,   36,     97},	{250,   37,     96},
			{251,   37,     95},	{251,   38,     93},	{251,   39,     92},	{251,   40,     91},	{252,   40,     90},	{252,   41,     89},	{252,   42,     88},	{252,   43,     88},
			{253,   43,     87},	{253,   44,     86},	{253,   45,     85},	{253,   46,     84},	{253,   47,     83},	{253,   47,     82},	{254,   48,     81},	{254,   49,     80},
			{254,   50,     79},	{254,   51,     78},	{254,   52,     77},	{254,   52,     76},	{254,   53,     75},	{254,   54,     74},	{255,   55,     73},	{255,   56,     72},
			{255,   57,     71},	{255,   58,     70},	{255,   58,     69},	{255,   59,     68},	{255,   60,     67},	{255,   61,     66},	{255,   62,     66},	{255,   63,     65},
		};
	}
}